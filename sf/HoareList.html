<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
"http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/>
<link href="coqdoc.css" rel="stylesheet" type="text/css"/>
<title>HoareList: Hoare Logic with Lists</title>
<script type="text/javascript" src="jquery-1.8.3.js"></script>
<script type="text/javascript" src="main.js"></script>
</head>

<body>

<div id="page">

<div id="header">
</div>

<div id="main">

<h1 class="libtitle">HoareList<span class="subtitle">Hoare Logic with Lists</span></h1>

<div class="code code-tight">
</div>

<div class="doc">

</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Require</span> <span class="id" type="keyword">Export</span> <span class="id" type="var">SfLib</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab465"></a><h1 class="section">Imp Programs with Lists</h1>

<div class="paragraph"> </div>

 There are only so many numeric functions with interesting
    properties that have simple proofs.  (Of course, there are lots of
    interesting functions on numbers and they have many interesting
    properties &mdash; this is the whole field of number theory! &mdash; but
    proving these properties often requires developing a lot of
    supporting lemmas.)  In order to able to write a few more programs
    to reason about, we introduce here an extended version of Imp
    where variables can range over both numbers and lists of numbers.
    The basic operations are extended to also include taking the head
    and tail of lists, and testing lists for nonemptyness. 

<div class="paragraph"> </div>

    To do this, we only need to change the definitions of <span class="inlinecode"><span class="id" type="var">state</span></span>,
    <span class="inlinecode"><span class="id" type="var">aexp</span></span>, <span class="inlinecode"><span class="id" type="var">aeval</span></span>, <span class="inlinecode"><span class="id" type="var">bexp</span></span>, and <span class="inlinecode"><span class="id" type="var">beval</span></span>. The definitions of <span class="inlinecode"><span class="id" type="var">com</span></span> and
    <span class="inlinecode"><span class="id" type="var">ceval</span></span> can be reused verbatim, although we need to copy-and-paste
    them in the context of the new definitions.

<div class="paragraph"> </div>

    We start by repeating some material from chapter <span class="inlinecode"><span class="id" type="var">Imp</span></span>. 
<div class="paragraph"> </div>

<a name="lab466"></a><h2 class="section">Repeated Definitions</h2>

</div>
<div class="code code-space">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">id</span> : <span class="id" type="keyword">Type</span> := <br/>
&nbsp;&nbsp;<span class="id" type="var">Id</span> : <span class="id" type="var">nat</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">id</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">eq_id_dec</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">id1</span> <span class="id" type="var">id2</span> : <span class="id" type="var">id</span>, {<span class="id" type="var">id1</span> = <span class="id" type="var">id2</span>} + {<span class="id" type="var">id1</span> &lt;&gt; <span class="id" type="var">id2</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">id1</span> <span class="id" type="var">id2</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">id1</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">n1</span>]. <span class="id" type="tactic">destruct</span> <span class="id" type="var">id2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">n2</span>].<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">eq_nat_dec</span> <span class="id" type="var">n1</span> <span class="id" type="var">n2</span>) <span class="id" type="keyword">as</span> [<span class="id" type="var">Heq</span> | <span class="id" type="var">Hneq</span>].<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "n1 = n2".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">left</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">Heq</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "n1 &lt;&gt; n2".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">right</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">contra</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">contra</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">Hneq</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>.<br/>
<span class="id" type="keyword">Defined</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">eq_id</span> : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">T</span>:<span class="id" type="keyword">Type</span>) <span class="id" type="var">x</span> (<span class="id" type="var">p</span> <span class="id" type="var">q</span>:<span class="id" type="var">T</span>), <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">if</span> <span class="id" type="var">eq_id_dec</span> <span class="id" type="var">x</span> <span class="id" type="var">x</span> <span class="id" type="keyword">then</span> <span class="id" type="var">p</span> <span class="id" type="keyword">else</span> <span class="id" type="var">q</span>) = <span class="id" type="var">p</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">eq_id_dec</span> <span class="id" type="var">x</span> <span class="id" type="var">x</span>).<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "x = x".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "x &lt;&gt; x (impossible)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ex_falso_quodlibet</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">n</span>; <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">neq_id</span> : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">T</span>:<span class="id" type="keyword">Type</span>) <span class="id" type="var">x</span> <span class="id" type="var">y</span> (<span class="id" type="var">p</span> <span class="id" type="var">q</span>:<span class="id" type="var">T</span>), <span class="id" type="var">x</span> &lt;&gt; <span class="id" type="var">y</span> <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="keyword">if</span> <span class="id" type="var">eq_id_dec</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span> <span class="id" type="keyword">then</span> <span class="id" type="var">p</span> <span class="id" type="keyword">else</span> <span class="id" type="var">q</span>) = <span class="id" type="var">q</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">eq_id_dec</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>).<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "x = y (impossible)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">ex_falso_quodlibet</span>; <span class="id" type="tactic">apply</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "x &lt;&gt; y".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">X</span> : <span class="id" type="var">id</span> := <span class="id" type="var">Id</span> 0.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Y</span> : <span class="id" type="var">id</span> := <span class="id" type="var">Id</span> 1.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Z</span> : <span class="id" type="var">id</span> := <span class="id" type="var">Id</span> 2.<br/>

<br/>
</div>

<div class="doc">
<a name="lab467"></a><h2 class="section">Extensions</h2>

<div class="paragraph"> </div>

 Now we come to the key changes.

<div class="paragraph"> </div>

    Rather than evaluating to a <span class="inlinecode"><span class="id" type="var">nat</span></span>, an <span class="inlinecode"><span class="id" type="var">aexp</span></span> in our new language
    will evaluate to a <i>value</i> &mdash; an element of type <span class="inlinecode"><span class="id" type="var">val</span></span> &mdash; which
    can be either a <span class="inlinecode"><span class="id" type="var">nat</span></span> or a list of <span class="inlinecode"><span class="id" type="var">nat</span></span>s.

<div class="paragraph"> </div>

    Similarly, <span class="inlinecode"><span class="id" type="var">state</span></span>s will now map identifiers to <span class="inlinecode"><span class="id" type="var">val</span></span>s rather than
    <span class="inlinecode"><span class="id" type="var">nat</span></span>s, so that we can store lists in mutable variables. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">val</span> : <span class="id" type="keyword">Type</span> :=<br/>
| <span class="id" type="var">VNat</span> : <span class="id" type="var">nat</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">val</span><br/>
| <span class="id" type="var">VList</span> : <span class="id" type="var">list</span> <span class="id" type="var">nat</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">val</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">state</span> := <span class="id" type="var">id</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">val</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">empty_state</span> : <span class="id" type="var">state</span> := <span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">VNat</span> 0.<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">update</span> (<span class="id" type="var">st</span> : <span class="id" type="var">state</span>) (<span class="id" type="var">X</span>:<span class="id" type="var">id</span>) (<span class="id" type="var">v</span> : <span class="id" type="var">val</span>) : <span class="id" type="var">state</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">X'</span> =&gt; <span class="id" type="keyword">if</span> <span class="id" type="var">eq_id_dec</span> <span class="id" type="var">X</span> <span class="id" type="var">X'</span> <span class="id" type="keyword">then</span> <span class="id" type="var">v</span> <span class="id" type="keyword">else</span> <span class="id" type="var">st</span> <span class="id" type="var">X'</span>.<br/>

<br/>
</div>

<div class="doc">
Imp does not have a static type system, so nothing prevents the
    programmer from e.g. adding two lists or taking the head of a
    number. We have to decide what to do in such nonsensical
    situations.

<div class="paragraph"> </div>

    We adopt a simple solution: if an arithmetic function is given a
    list as an argument we treat the list as if it was the number
    <span class="inlinecode">0</span>. Similarly, if a list function is given a number as an
    argument we treat the number as if it was <span class="inlinecode"><span class="id" type="var">nil</span></span>.  (Cf. Javascript,
    where adding <span class="inlinecode">3</span> to the empty list evaluates to <span class="inlinecode">3</span>...)

<div class="paragraph"> </div>

    The two functions <span class="inlinecode"><span class="id" type="var">asnat</span></span> and <span class="inlinecode"><span class="id" type="var">aslist</span></span> interpret <span class="inlinecode"><span class="id" type="var">val</span></span>s in a
    numeric or a list context; <span class="inlinecode"><span class="id" type="var">aeval</span></span> calls these whenever it
    evaluates an arithmetic or a list operation.
</div>
<div class="code code-tight">

<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">asnat</span> (<span class="id" type="var">v</span> : <span class="id" type="var">val</span>) : <span class="id" type="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">v</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">VNat</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="var">n</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">VList</span> <span class="id" type="var">_</span> =&gt; 0<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">aslist</span> (<span class="id" type="var">v</span> : <span class="id" type="var">val</span>) : <span class="id" type="var">list</span> <span class="id" type="var">nat</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">v</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">VNat</span> <span class="id" type="var">n</span> =&gt; []<br/>
&nbsp;&nbsp;| <span class="id" type="var">VList</span> <span class="id" type="var">xs</span> =&gt; <span class="id" type="var">xs</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Now we fill in the definitions of abstract syntax and
    evaluation functions for arithmetic and boolean expressions. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">aexp</span> : <span class="id" type="keyword">Type</span> := <br/>
&nbsp;&nbsp;| <span class="id" type="var">ANum</span> : <span class="id" type="var">nat</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">AId</span> : <span class="id" type="var">id</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">APlus</span> : <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">AMinus</span> : <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">AMult</span> : <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Four&nbsp;new&nbsp;cases:&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">AHead</span> : <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ATail</span> : <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ACons</span> : <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ANil</span>  : <span class="id" type="var">aexp</span>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "aexp_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ANum" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "AId" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "APlus"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "AMinus" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "AMult"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "AHead" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ATail"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ACons" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "ANil" ].<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">tail</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">nat</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">x</span>::<span class="id" type="var">xs</span> =&gt; <span class="id" type="var">xs</span><br/>
&nbsp;&nbsp;| [] =&gt; []<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">head</span> (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">nat</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">x</span>::<span class="id" type="var">xs</span> =&gt; <span class="id" type="var">x</span><br/>
&nbsp;&nbsp;| [] =&gt; 0<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">aeval</span> (<span class="id" type="var">st</span> : <span class="id" type="var">state</span>) (<span class="id" type="var">e</span> : <span class="id" type="var">aexp</span>) : <span class="id" type="var">val</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">e</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ANum</span> <span class="id" type="var">n</span> =&gt; <span class="id" type="var">VNat</span> <span class="id" type="var">n</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">AId</span> <span class="id" type="var">i</span> =&gt; <span class="id" type="var">st</span> <span class="id" type="var">i</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">APlus</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>   =&gt; <span class="id" type="var">VNat</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a1</span>) + <span class="id" type="var">asnat</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a2</span>))<br/>
&nbsp;&nbsp;| <span class="id" type="var">AMinus</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>  =&gt; <span class="id" type="var">VNat</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a1</span>) - <span class="id" type="var">asnat</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a2</span>))<br/>
&nbsp;&nbsp;| <span class="id" type="var">AMult</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>   =&gt; <span class="id" type="var">VNat</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a1</span>) * <span class="id" type="var">asnat</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a2</span>))<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Four&nbsp;new&nbsp;cases:&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">ATail</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="var">VList</span> (<span class="id" type="var">tail</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a</span>)))<br/>
&nbsp;&nbsp;| <span class="id" type="var">AHead</span> <span class="id" type="var">a</span> =&gt; <span class="id" type="var">VNat</span> (<span class="id" type="var">head</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a</span>)))<br/>
&nbsp;&nbsp;| <span class="id" type="var">ACons</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span> =&gt; <span class="id" type="var">VList</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a1</span>) :: <span class="id" type="var">aslist</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a2</span>))<br/>
&nbsp;&nbsp;| <span class="id" type="var">ANil</span> =&gt; <span class="id" type="var">VList</span> []<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
We extend <span class="inlinecode"><span class="id" type="var">bexp</span></span>s with an operation to test if a list is nonempty
    and adapt <span class="inlinecode"><span class="id" type="var">beval</span></span> acordingly. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">bexp</span> : <span class="id" type="keyword">Type</span> := <br/>
&nbsp;&nbsp;| <span class="id" type="var">BTrue</span> : <span class="id" type="var">bexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BFalse</span> : <span class="id" type="var">bexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BEq</span> : <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">bexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BLe</span> : <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">bexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BNot</span> : <span class="id" type="var">bexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">bexp</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BAnd</span> : <span class="id" type="var">bexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">bexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">bexp</span><br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;New&nbsp;case:&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BIsCons</span> : <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">bexp</span>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "bexp_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "BTrue" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "BFalse" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "BEq"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "BLe" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "BNot" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "BAnd"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "BIsCons" ].<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">beval</span> (<span class="id" type="var">st</span> : <span class="id" type="var">state</span>) (<span class="id" type="var">e</span> : <span class="id" type="var">bexp</span>) : <span class="id" type="var">bool</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">e</span> <span class="id" type="keyword">with</span> <br/>
&nbsp;&nbsp;| <span class="id" type="var">BTrue</span>       =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BFalse</span>      =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BEq</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>   =&gt; <span class="id" type="var">beq_nat</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a1</span>)) (<span class="id" type="var">asnat</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a2</span>))<br/>
&nbsp;&nbsp;| <span class="id" type="var">BLe</span> <span class="id" type="var">a1</span> <span class="id" type="var">a2</span>   =&gt; <span class="id" type="var">ble_nat</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a1</span>)) (<span class="id" type="var">asnat</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a2</span>))<br/>
&nbsp;&nbsp;| <span class="id" type="var">BNot</span> <span class="id" type="var">b1</span>     =&gt; <span class="id" type="var">negb</span> (<span class="id" type="var">beval</span> <span class="id" type="var">st</span> <span class="id" type="var">b1</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">BAnd</span> <span class="id" type="var">b1</span> <span class="id" type="var">b2</span>  =&gt; <span class="id" type="var">andb</span> (<span class="id" type="var">beval</span> <span class="id" type="var">st</span> <span class="id" type="var">b1</span>) (<span class="id" type="var">beval</span> <span class="id" type="var">st</span> <span class="id" type="var">b2</span>)<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;New&nbsp;case:&nbsp;*)</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">BIsCons</span> <span class="id" type="var">a</span>    =&gt; <span class="id" type="keyword">match</span> <span class="id" type="var">aslist</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a</span>) <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| <span class="id" type="var">_</span>::_ =&gt; <span class="id" type="var">true</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;| [] =&gt; <span class="id" type="var">false</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="keyword">end</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab468"></a><h2 class="section">Repeated Definitions</h2>

<div class="paragraph"> </div>

 Now we need to repeat a little bit of low-level work from Imp.v,
    plus the definitions of <span class="inlinecode"><span class="id" type="var">com</span></span> and <span class="inlinecode"><span class="id" type="var">ceval</span></span>.  There are no
    interesting changes &mdash; it's just a matter of repeating the same
    definitions, lemmas, and proofs in the context of the new
    definitions of arithmetic and boolean expressions.  

<div class="paragraph"> </div>

    (Is all this cutting and pasting really necessary?  No: Coq
    includes a powerful module system that we could use to abstract
    the repeated definitions with respect to the varying parts.  But
    explaining how it works would distract us from the topic at hand.)
 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">update_eq</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span> <span class="id" type="var">V</span> <span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="var">update</span> <span class="id" type="var">st</span> <span class="id" type="var">V</span> <span class="id" type="var">n</span>) <span class="id" type="var">V</span> = <span class="id" type="var">n</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">V</span> <span class="id" type="var">st</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">update</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">eq_id</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">update_neq</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">V2</span> <span class="id" type="var">V1</span> <span class="id" type="var">n</span> <span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">V2</span> &lt;&gt; <span class="id" type="var">V1</span> <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;(<span class="id" type="var">update</span> <span class="id" type="var">st</span> <span class="id" type="var">V2</span> <span class="id" type="var">n</span>) <span class="id" type="var">V1</span> = (<span class="id" type="var">st</span> <span class="id" type="var">V1</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">V2</span> <span class="id" type="var">V1</span> <span class="id" type="var">n</span> <span class="id" type="var">st</span> <span class="id" type="var">Hneq</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">update</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">neq_id</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">update_shadow</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> (<span class="id" type="var">f</span> : <span class="id" type="var">state</span>),<br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">update</span>  (<span class="id" type="var">update</span> <span class="id" type="var">f</span> <span class="id" type="var">k2</span> <span class="id" type="var">x1</span>) <span class="id" type="var">k2</span> <span class="id" type="var">x2</span>) <span class="id" type="var">k1</span> = (<span class="id" type="var">update</span> <span class="id" type="var">f</span> <span class="id" type="var">k2</span> <span class="id" type="var">x2</span>) <span class="id" type="var">k1</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">f</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">update</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">eq_id_dec</span> <span class="id" type="var">k2</span> <span class="id" type="var">k1</span>); <span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">update_same</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">x1</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> (<span class="id" type="var">f</span> : <span class="id" type="var">state</span>),<br/>
&nbsp;&nbsp;<span class="id" type="var">f</span> <span class="id" type="var">k1</span> = <span class="id" type="var">x1</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;(<span class="id" type="var">update</span> <span class="id" type="var">f</span> <span class="id" type="var">k1</span> <span class="id" type="var">x1</span>) <span class="id" type="var">k2</span> = <span class="id" type="var">f</span> <span class="id" type="var">k2</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x1</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">f</span> <span class="id" type="var">Heq</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">update</span>. <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">eq_id_dec</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span>).<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "k1 = k2".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "k1 &lt;&gt; k2".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">update_permute</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span> <span class="id" type="var">f</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">k2</span> &lt;&gt; <span class="id" type="var">k1</span> <span style="font-family: arial;">&rarr;</span> <br/>
&nbsp;&nbsp;(<span class="id" type="var">update</span> (<span class="id" type="var">update</span> <span class="id" type="var">f</span> <span class="id" type="var">k2</span> <span class="id" type="var">x1</span>) <span class="id" type="var">k1</span> <span class="id" type="var">x2</span>) <span class="id" type="var">k3</span> = (<span class="id" type="var">update</span> (<span class="id" type="var">update</span> <span class="id" type="var">f</span> <span class="id" type="var">k1</span> <span class="id" type="var">x2</span>) <span class="id" type="var">k2</span> <span class="id" type="var">x1</span>) <span class="id" type="var">k3</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x1</span> <span class="id" type="var">x2</span> <span class="id" type="var">k1</span> <span class="id" type="var">k2</span> <span class="id" type="var">k3</span> <span class="id" type="var">f</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">update</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">eq_id_dec</span> <span class="id" type="var">k1</span> <span class="id" type="var">k3</span>); <span class="id" type="tactic">try</span> <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "k1 = k3".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">neq_id</span>. <span class="id" type="tactic">reflexivity</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
We can keep exactly the same old definitions of <span class="inlinecode"><span class="id" type="var">com</span></span> and
    <span class="inlinecode"><span class="id" type="var">ceval</span></span>. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">com</span> : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">CSkip</span> : <span class="id" type="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CAss</span> : <span class="id" type="var">id</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CSeq</span> : <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CIf</span> : <span class="id" type="var">bexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">CWhile</span> : <span class="id" type="var">bexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "com_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "SKIP" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "::=" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> ";"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "IFB" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "WHILE" ].<br/>

<br/>
<span class="id" type="keyword">Notation</span> "'SKIP'" := <br/>
&nbsp;&nbsp;<span class="id" type="var">CSkip</span>.<br/>
<span class="id" type="keyword">Notation</span> "X '::=' a" := <br/>
&nbsp;&nbsp;(<span class="id" type="var">CAss</span> <span class="id" type="var">X</span> <span class="id" type="var">a</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 60).<br/>
<span class="id" type="keyword">Notation</span> "c1 ; c2" := <br/>
&nbsp;&nbsp;(<span class="id" type="var">CSeq</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "'WHILE' b 'DO' c 'END'" := <br/>
&nbsp;&nbsp;(<span class="id" type="var">CWhile</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>
<span class="id" type="keyword">Notation</span> "'IFB' e1 'THEN' e2 'ELSE' e3 'FI'" := <br/>
&nbsp;&nbsp;(<span class="id" type="var">CIf</span> <span class="id" type="var">e1</span> <span class="id" type="var">e2</span> <span class="id" type="var">e3</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>).<br/>

<br/>
<span class="id" type="keyword">Reserved Notation</span> "c1 '/' st '<span style="font-family: arial;">&dArr;</span>' st'" (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 40, <span class="id" type="var">st</span> <span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 39).<br/>

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">ceval</span> : <span class="id" type="var">state</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">com</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">state</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">E_Skip</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SKIP</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">E_Asgn</span>  : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">a1</span> <span class="id" type="var">n</span> <span class="id" type="var">X</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a1</span> = <span class="id" type="var">n</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">X</span> ::= <span class="id" type="var">a1</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&dArr;</span> (<span class="id" type="var">update</span> <span class="id" type="var">st</span> <span class="id" type="var">X</span> <span class="id" type="var">n</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">E_Seq</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">c1</span> <span class="id" type="var">c2</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">st''</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">c1</span> / <span class="id" type="var">st</span>  <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">c2</span> / <span class="id" type="var">st'</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st''</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">c1</span> ; <span class="id" type="var">c2</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st''</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">E_IfTrue</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">b1</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">beval</span> <span class="id" type="var">st</span> <span class="id" type="var">b1</span> = <span class="id" type="var">true</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">c1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">IFB</span> <span class="id" type="var">b1</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c2</span> <span class="id" type="var">FI</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st'</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">E_IfFalse</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">b1</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">beval</span> <span class="id" type="var">st</span> <span class="id" type="var">b1</span> = <span class="id" type="var">false</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">c2</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">IFB</span> <span class="id" type="var">b1</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c2</span> <span class="id" type="var">FI</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st'</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">E_WhileEnd</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">b1</span> <span class="id" type="var">st</span> <span class="id" type="var">c1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">beval</span> <span class="id" type="var">st</span> <span class="id" type="var">b1</span> = <span class="id" type="var">false</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">WHILE</span> <span class="id" type="var">b1</span> <span class="id" type="var">DO</span> <span class="id" type="var">c1</span> <span class="id" type="var">END</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">E_WhileLoop</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">st''</span> <span class="id" type="var">b1</span> <span class="id" type="var">c1</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">beval</span> <span class="id" type="var">st</span> <span class="id" type="var">b1</span> = <span class="id" type="var">true</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">c1</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">WHILE</span> <span class="id" type="var">b1</span> <span class="id" type="var">DO</span> <span class="id" type="var">c1</span> <span class="id" type="var">END</span>) / <span class="id" type="var">st'</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st''</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">WHILE</span> <span class="id" type="var">b1</span> <span class="id" type="var">DO</span> <span class="id" type="var">c1</span> <span class="id" type="var">END</span>) / <span class="id" type="var">st</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st''</span><br/>
<br/>
&nbsp;&nbsp;<span class="id" type="keyword">where</span> "c1 '/' st '<span style="font-family: arial;">&dArr;</span>' st'" := (<span class="id" type="var">ceval</span> <span class="id" type="var">st</span> <span class="id" type="var">c1</span> <span class="id" type="var">st'</span>).<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "ceval_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "E_Skip" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "E_Asgn" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "E_Seq"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "E_IfTrue" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "E_IfFalse"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "E_WhileEnd" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "E_WhileLoop" ].<br/>

<br/>
</div>

<div class="doc">
<a name="lab469"></a><h1 class="section">Hoare Rules</h1>

<div class="paragraph"> </div>

 We copy verbatim the Hoare rules from Hoare.v. 
<div class="paragraph"> </div>

<center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (hoare_asgn) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{assn_sub&nbsp;X&nbsp;a&nbsp;Q<span style="letter-spacing:-.4em;">}</span>}&nbsp;X::=a&nbsp;<span style="letter-spacing:-.4em;">{</span>{Q<span style="letter-spacing:-.4em;">}</span>}</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule">&nbsp;&nbsp;</td>
  <td class="infrulenamecol" rowspan="3">
    (hoare_skip) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{&nbsp;P&nbsp;<span style="letter-spacing:-.4em;">}</span>}&nbsp;SKIP&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;P&nbsp;<span style="letter-spacing:-.4em;">}</span>}</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{&nbsp;P&nbsp;<span style="letter-spacing:-.4em;">}</span>}&nbsp;c1&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;Q&nbsp;<span style="letter-spacing:-.4em;">}</span>}</td>
  <td></td>
</td>
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{&nbsp;Q&nbsp;<span style="letter-spacing:-.4em;">}</span>}&nbsp;c2&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;R&nbsp;<span style="letter-spacing:-.4em;">}</span>}</td>
  <td class="infrulenamecol" rowspan="3">
    (hoare_seq) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{&nbsp;P&nbsp;<span style="letter-spacing:-.4em;">}</span>}&nbsp;c1;c2&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;R&nbsp;<span style="letter-spacing:-.4em;">}</span>}</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{P&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;&nbsp;b<span style="letter-spacing:-.4em;">}</span>}&nbsp;c1&nbsp;<span style="letter-spacing:-.4em;">{</span>{Q<span style="letter-spacing:-.4em;">}</span>}</td>
  <td></td>
</td>
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{P&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;~b<span style="letter-spacing:-.4em;">}</span>}&nbsp;c2&nbsp;<span style="letter-spacing:-.4em;">{</span>{Q<span style="letter-spacing:-.4em;">}</span>}</td>
  <td class="infrulenamecol" rowspan="3">
    (hoare_if) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{P<span style="letter-spacing:-.4em;">}</span>}&nbsp;IFB&nbsp;b&nbsp;THEN&nbsp;c1&nbsp;ELSE&nbsp;c2&nbsp;FI&nbsp;<span style="letter-spacing:-.4em;">{</span>{Q<span style="letter-spacing:-.4em;">}</span>}</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{P&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;b<span style="letter-spacing:-.4em;">}</span>}&nbsp;c&nbsp;<span style="letter-spacing:-.4em;">{</span>{P<span style="letter-spacing:-.4em;">}</span>}</td>
  <td class="infrulenamecol" rowspan="3">
    (hoare_while) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{P<span style="letter-spacing:-.4em;">}</span>}&nbsp;WHILE&nbsp;b&nbsp;DO&nbsp;c&nbsp;END&nbsp;<span style="letter-spacing:-.4em;">{</span>{P&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;~b<span style="letter-spacing:-.4em;">}</span>}</td>
  <td></td>
</td>
</table></center><center><table class="infrule">
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{P'<span style="letter-spacing:-.4em;">}</span>}&nbsp;c&nbsp;<span style="letter-spacing:-.4em;">{</span>{Q'<span style="letter-spacing:-.4em;">}</span>}</td>
  <td></td>
</td>
<tr class="infruleassumption">
  <td class="infrule">P&nbsp;<span style="font-family: arial;">&#8702;</span>&nbsp;P'</td>
  <td></td>
</td>
<tr class="infruleassumption">
  <td class="infrule">Q'&nbsp;<span style="font-family: arial;">&#8702;</span>&nbsp;Q</td>
  <td class="infrulenamecol" rowspan="3">
    (hoare_consequence) &nbsp;
  </td></tr>
<tr class="infrulemiddle">
  <td class="infrule"><hr /></td>
</tr>
<tr class="infruleassumption">
  <td class="infrule"><span style="letter-spacing:-.4em;">{</span>{P<span style="letter-spacing:-.4em;">}</span>}&nbsp;c&nbsp;<span style="letter-spacing:-.4em;">{</span>{Q<span style="letter-spacing:-.4em;">}</span>}</td>
  <td></td>
</td>
</table></center>
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">Assertion</span> := <span class="id" type="var">state</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="keyword">Prop</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">hoare_triple</span> (<span class="id" type="var">P</span>:<span class="id" type="var">Assertion</span>) (<span class="id" type="var">c</span>:<span class="id" type="var">com</span>) (<span class="id" type="var">Q</span>:<span class="id" type="var">Assertion</span>) : <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span> <span class="id" type="var">st'</span>, <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">c</span> / <span class="id" type="var">st</span> <span style="font-family: arial;">&dArr;</span> <span class="id" type="var">st'</span>  <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">P</span> <span class="id" type="var">st</span>  <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Q</span> <span class="id" type="var">st'</span>.<br/>

<br/>
<span class="id" type="keyword">Notation</span> "<span style="letter-spacing:-.4em;">{</span>{ P <span style="letter-spacing:-.4em;">}</span>}  c  <span style="letter-spacing:-.4em;">{</span>{ Q <span style="letter-spacing:-.4em;">}</span>}" := (<span class="id" type="var">hoare_triple</span> <span class="id" type="var">P</span> <span class="id" type="var">c</span> <span class="id" type="var">Q</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 90, <span class="id" type="var">c</span> <span class="id" type="tactic">at</span> <span class="id" type="var">next</span> <span class="id" type="var">level</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;: <span class="id" type="var">hoare_spec_scope</span>.<br/>
<span class="id" type="keyword">Open</span> <span class="id" type="keyword">Scope</span> <span class="id" type="var">hoare_spec_scope</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">assn_sub</span> <span class="id" type="var">X</span> <span class="id" type="var">a</span> <span class="id" type="var">Q</span> : <span class="id" type="var">Assertion</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> (<span class="id" type="var">st</span> : <span class="id" type="var">state</span>) =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Q</span> (<span class="id" type="var">update</span> <span class="id" type="var">st</span> <span class="id" type="var">X</span> (<span class="id" type="var">aeval</span> <span class="id" type="var">st</span> <span class="id" type="var">a</span>)).<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">hoare_asgn</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">Q</span> <span class="id" type="var">X</span> <span class="id" type="var">a</span>,<br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">assn_sub</span> <span class="id" type="var">X</span> <span class="id" type="var">a</span> <span class="id" type="var">Q</span><span style="letter-spacing:-.4em;">}</span>} (<span class="id" type="var">X</span> ::= <span class="id" type="var">a</span>) <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q</span><span style="letter-spacing:-.4em;">}</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">hoare_triple</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Q</span> <span class="id" type="var">X</span> <span class="id" type="var">a</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">HE</span> <span class="id" type="var">HQ</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">HE</span>. <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">assn_sub</span> <span class="id" type="keyword">in</span> <span class="id" type="var">HQ</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">hoare_skip</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">P</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">SKIP</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">P</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">H</span> <span class="id" type="var">HP</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">hoare_seq</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">P</span> <span class="id" type="var">Q</span> <span class="id" type="var">R</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c2</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">R</span><span style="letter-spacing:-.4em;">}</span>} <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c1</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q</span><span style="letter-spacing:-.4em;">}</span>} <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c1</span>;<span class="id" type="var">c2</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">R</span><span style="letter-spacing:-.4em;">}</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">P</span> <span class="id" type="var">Q</span> <span class="id" type="var">R</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span> <span class="id" type="var">H1</span> <span class="id" type="var">H2</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">H12</span> <span class="id" type="var">Pre</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H12</span>; <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">H1</span> <span class="id" type="var">st'0</span> <span class="id" type="var">st'</span>); <span class="id" type="tactic">try</span> <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">H2</span> <span class="id" type="var">st</span> <span class="id" type="var">st'0</span>); <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">bassn</span> <span class="id" type="var">b</span> : <span class="id" type="var">Assertion</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; (<span class="id" type="var">beval</span> <span class="id" type="var">st</span> <span class="id" type="var">b</span> = <span class="id" type="var">true</span>).<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">bexp_eval_true</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">b</span> <span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">beval</span> <span class="id" type="var">st</span> <span class="id" type="var">b</span> = <span class="id" type="var">true</span> <span style="font-family: arial;">&rarr;</span> (<span class="id" type="var">bassn</span> <span class="id" type="var">b</span>) <span class="id" type="var">st</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">st</span> <span class="id" type="var">Hbe</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">bassn</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">bexp_eval_false</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">b</span> <span class="id" type="var">st</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">beval</span> <span class="id" type="var">st</span> <span class="id" type="var">b</span> = <span class="id" type="var">false</span> <span style="font-family: arial;">&rarr;</span> ~ ((<span class="id" type="var">bassn</span> <span class="id" type="var">b</span>) <span class="id" type="var">st</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">b</span> <span class="id" type="var">st</span> <span class="id" type="var">Hbe</span> <span class="id" type="var">contra</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">bassn</span> <span class="id" type="keyword">in</span> <span class="id" type="var">contra</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">contra</span> <span class="id" type="keyword">in</span> <span class="id" type="var">Hbe</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">Hbe</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">hoare_if</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">P</span> <span class="id" type="var">Q</span> <span class="id" type="var">b</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>,<br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">st</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">bassn</span> <span class="id" type="var">b</span> <span class="id" type="var">st</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c1</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q</span><span style="letter-spacing:-.4em;">}</span>} <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">st</span> <span style="font-family: arial;">&and;</span> ~(<span class="id" type="var">bassn</span> <span class="id" type="var">b</span> <span class="id" type="var">st</span>)<span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c2</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q</span><span style="letter-spacing:-.4em;">}</span>} <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>} (<span class="id" type="var">IFB</span> <span class="id" type="var">b</span> <span class="id" type="var">THEN</span> <span class="id" type="var">c1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">c2</span> <span class="id" type="var">FI</span>) <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q</span><span style="letter-spacing:-.4em;">}</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">P</span> <span class="id" type="var">Q</span> <span class="id" type="var">b</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span> <span class="id" type="var">HTrue</span> <span class="id" type="var">HFalse</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">HE</span> <span class="id" type="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">HE</span>; <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "b is true".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">HTrue</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">bexp_eval_true</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "b is false".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">HFalse</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">bexp_eval_false</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">hoare_while</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">P</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span>,<br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">st</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">bassn</span> <span class="id" type="var">b</span> <span class="id" type="var">st</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>} <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">WHILE</span> <span class="id" type="var">b</span> <span class="id" type="var">DO</span> <span class="id" type="var">c</span> <span class="id" type="var">END</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">st</span> <span style="font-family: arial;">&and;</span> ~ (<span class="id" type="var">bassn</span> <span class="id" type="var">b</span> <span class="id" type="var">st</span>)<span style="letter-spacing:-.4em;">}</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">P</span> <span class="id" type="var">b</span> <span class="id" type="var">c</span> <span class="id" type="var">Hhoare</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">He</span> <span class="id" type="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;Like&nbsp;we've&nbsp;seen&nbsp;before,&nbsp;we&nbsp;need&nbsp;to&nbsp;reason&nbsp;by&nbsp;induction&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;on&nbsp;He,&nbsp;because,&nbsp;in&nbsp;the&nbsp;"keep&nbsp;looping"&nbsp;case,&nbsp;its&nbsp;hypotheses&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;talk&nbsp;about&nbsp;the&nbsp;whole&nbsp;loop&nbsp;instead&nbsp;of&nbsp;just&nbsp;c&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" type="var">remember</span> (<span class="id" type="var">WHILE</span> <span class="id" type="var">b</span> <span class="id" type="var">DO</span> <span class="id" type="var">c</span> <span class="id" type="var">END</span>) <span class="id" type="keyword">as</span> <span class="id" type="var">wcom</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">ceval_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">He</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">try</span> (<span class="id" type="tactic">inversion</span> <span class="id" type="var">Heqwcom</span>); <span class="id" type="tactic">subst</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "E_WhileEnd".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">bexp_eval_false</span>. <span class="id" type="tactic">assumption</span>.<br/>

<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "E_WhileLoop".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHHe2</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">Hhoare</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>); <span class="id" type="tactic">try</span> <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">bexp_eval_true</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">assert_implies</span> (<span class="id" type="var">P</span> <span class="id" type="var">Q</span> : <span class="id" type="var">Assertion</span>) : <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span style="font-family: arial;">&forall;</span><span class="id" type="var">st</span>, <span class="id" type="var">P</span> <span class="id" type="var">st</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">Q</span> <span class="id" type="var">st</span>.<br/>

<br/>
<span class="id" type="keyword">Notation</span> "P <span style="font-family: arial;">&#8702;</span> Q" := (<span class="id" type="var">assert_implies</span> <span class="id" type="var">P</span> <span class="id" type="var">Q</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80).<br/>
<span class="id" type="keyword">Notation</span> "P <span style="font-family: arial;">&#8703;</span> Q" := (<span class="id" type="var">P</span> <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">Q</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">Q</span> <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">P</span>) (<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80).<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">hoare_consequence_pre</span> : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">P</span> <span class="id" type="var">P'</span> <span class="id" type="var">Q</span> : <span class="id" type="var">Assertion</span>) <span class="id" type="var">c</span>,<br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P'</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q</span><span style="letter-spacing:-.4em;">}</span>} <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span class="id" type="var">P</span> <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">P'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q</span><span style="letter-spacing:-.4em;">}</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">P</span> <span class="id" type="var">P'</span> <span class="id" type="var">Q</span> <span class="id" type="var">c</span> <span class="id" type="var">Hhoare</span> <span class="id" type="var">Himp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">Hc</span> <span class="id" type="var">HP</span>. <span class="id" type="tactic">apply</span> (<span class="id" type="var">Hhoare</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">Himp</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">hoare_consequence_post</span> : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">P</span> <span class="id" type="var">Q</span> <span class="id" type="var">Q'</span> : <span class="id" type="var">Assertion</span>) <span class="id" type="var">c</span>,<br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q'</span><span style="letter-spacing:-.4em;">}</span>} <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span class="id" type="var">Q'</span> <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">Q</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q</span><span style="letter-spacing:-.4em;">}</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">P</span> <span class="id" type="var">Q</span> <span class="id" type="var">Q'</span> <span class="id" type="var">c</span> <span class="id" type="var">Hhoare</span> <span class="id" type="var">Himp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">Hc</span> <span class="id" type="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">Himp</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> (<span class="id" type="var">Hhoare</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>).<br/>
&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">hoare_consequence</span> : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">P</span> <span class="id" type="var">P'</span> <span class="id" type="var">Q</span> <span class="id" type="var">Q'</span> : <span class="id" type="var">Assertion</span>) <span class="id" type="var">c</span>,<br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P'</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q'</span><span style="letter-spacing:-.4em;">}</span>} <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span class="id" type="var">P</span> <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">P'</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span class="id" type="var">Q'</span> <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">Q</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>} <span class="id" type="var">c</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">Q</span><span style="letter-spacing:-.4em;">}</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">P</span> <span class="id" type="var">P'</span> <span class="id" type="var">Q</span> <span class="id" type="var">Q'</span> <span class="id" type="var">c</span> <span class="id" type="var">Hht</span> <span class="id" type="var">HPP'</span> <span class="id" type="var">HQ'Q</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span> <span class="id" type="var">Hc</span> <span class="id" type="var">HP</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">HQ'Q</span>. <span class="id" type="tactic">apply</span> (<span class="id" type="var">Hht</span> <span class="id" type="var">st</span> <span class="id" type="var">st'</span>). <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">HPP'</span>. <span class="id" type="tactic">assumption</span>. <span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab470"></a><h2 class="section">Reasoning About Programs with Lists</h2>

<div class="paragraph"> </div>

 Now let's look at a formal Hoare Logic proof for a program that
    works with lists.  We will verify the following program, which
    checks if the number <span class="inlinecode"><span class="id" type="var">Y</span></span> occurs in the list <span class="inlinecode"><span class="id" type="var">X</span></span>, and if so sets
    <span class="inlinecode"><span class="id" type="var">Z</span></span> to <span class="inlinecode">1</span>. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">list_member</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">WHILE</span> <span class="id" type="var">BIsCons</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>) <span class="id" type="var">DO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">IFB</span> (<span class="id" type="var">BEq</span> (<span class="id" type="var">AId</span> <span class="id" type="var">Y</span>) (<span class="id" type="var">AHead</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>))) <span class="id" type="var">THEN</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Z</span> ::= (<span class="id" type="var">ANum</span> 1) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ELSE</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SKIP</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">FI</span>; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">X</span> ::= <span class="id" type="var">ATail</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>)<br/>
&nbsp;&nbsp;<span class="id" type="var">END</span>.<br/>

<br/>
</div>

<div class="doc">
The informal proof looks like this:

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;<span class="id" type="var">Z</span>&nbsp;=&nbsp;0&nbsp;<span style="letter-spacing:-.4em;">}</span>}&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>)&nbsp;<span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;<span class="id" type="var">WHILE</span>&nbsp;(<span class="id" type="var">BIsCons</span>&nbsp;<span class="id" type="var">X</span>)&nbsp;<br/>
&nbsp;&nbsp;<span class="id" type="var">DO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">BIsCons</span>&nbsp;<span class="id" type="var">X</span>)&nbsp;<span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">IFB</span>&nbsp;(<span class="id" type="var">Y</span>&nbsp;==&nbsp;<span class="id" type="var">head</span>&nbsp;<span class="id" type="var">X</span>)&nbsp;<span class="id" type="var">THEN</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>))&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">BIsCons</span>&nbsp;<span class="id" type="var">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;<span class="id" type="var">Y</span>&nbsp;==&nbsp;<span class="id" type="var">AHead</span>&nbsp;<span class="id" type="var">X</span>&nbsp;<span style="letter-spacing:-.4em;">}</span>}&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">tail</span>&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(1&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>))&nbsp;<span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Z</span>&nbsp;::=&nbsp;1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">tail</span>&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>))&nbsp;<span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">ELSE</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>))&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">BIsCons</span>&nbsp;<span class="id" type="var">X</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;~&nbsp;(<span class="id" type="var">Y</span>&nbsp;==&nbsp;<span class="id" type="var">head</span>&nbsp;<span class="id" type="var">X</span>)&nbsp;<span style="letter-spacing:-.4em;">}</span>}&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">tail</span>&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>))&nbsp;<span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SKIP</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">tail</span>&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>))&nbsp;<span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">FI</span>;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">tail</span>&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>))&nbsp;<span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">X</span>&nbsp;::=&nbsp;<span class="id" type="var">ATail</span>&nbsp;<span class="id" type="var">X</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>))&nbsp;<span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;<span class="id" type="var">END</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">n</span>&nbsp;&nbsp;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>))&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;~&nbsp;(<span class="id" type="var">BIsCons</span>&nbsp;<span class="id" type="var">X</span>)&nbsp;<span style="letter-spacing:-.4em;">}</span>}&nbsp;=&gt;&nbsp;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="letter-spacing:-.4em;">}</span>}
<div class="paragraph"> </div>

</div>

<div class="paragraph"> </div>

  The only interesting part of the proof is the choice of loop invariant:

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>,&nbsp;<span class="id" type="var">p</span>&nbsp;++&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;(<span class="id" type="var">Z</span>&nbsp;=&nbsp;1&nbsp;<span style="font-family: arial;">&harr;</span>&nbsp;<span class="id" type="var">appears_in</span>&nbsp;<span class="id" type="var">n</span>&nbsp;<span class="id" type="var">p</span>)
<div class="paragraph"> </div>

</div>
  This states that at each iteration of the loop, the original list
  <span class="inlinecode"><span class="id" type="var">l</span></span> is equal to the append of the current value of <span class="inlinecode"><span class="id" type="var">X</span></span> and some
  other list <span class="inlinecode"><span class="id" type="var">p</span></span> which is not the value of any variable in the
  program, but keeps track of enough information from the original
  state to make the proof go through. (Such a <span class="inlinecode"><span class="id" type="var">p</span></span> is sometimes called
  a "ghost variable"). 
<div class="paragraph"> </div>

 In order to show that such a list <span class="inlinecode"><span class="id" type="var">p</span></span> exists, in each iteration we
    add the head of <span class="inlinecode"><span class="id" type="var">X</span></span> to the <i>end</i> of <span class="inlinecode"><span class="id" type="var">p</span></span>. This needs the function
    <span class="inlinecode"><span class="id" type="var">snoc</span></span>, from Poly.v. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">snoc</span> {<span class="id" type="var">X</span>:<span class="id" type="keyword">Type</span>} (<span class="id" type="var">l</span>:<span class="id" type="var">list</span> <span class="id" type="var">X</span>) (<span class="id" type="var">v</span>:<span class="id" type="var">X</span>) : (<span class="id" type="var">list</span> <span class="id" type="var">X</span>) := <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span>      =&gt;  [ <span class="id" type="var">v</span> ]<br/>
&nbsp;&nbsp;| <span class="id" type="var">cons</span> <span class="id" type="var">h</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="var">h</span> :: (<span class="id" type="var">snoc</span> <span class="id" type="var">t</span> <span class="id" type="var">v</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
The main proof uses several lemmas about <span class="inlinecode"><span class="id" type="var">snoc</span></span> and <span class="inlinecode">++</span>. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">snoc_equation</span> : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">h</span>:<span class="id" type="var">A</span>) (<span class="id" type="var">x</span> <span class="id" type="var">y</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" type="var">snoc</span> <span class="id" type="var">x</span> <span class="id" type="var">h</span> ++ <span class="id" type="var">y</span> = <span class="id" type="var">x</span> ++ <span class="id" type="var">h</span> :: <span class="id" type="var">y</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">A</span> <span class="id" type="var">h</span> <span class="id" type="var">x</span> <span class="id" type="var">y</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">x</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "x = []". <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "x = cons". <span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHx</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">appears_in_snoc1</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">a</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">appears_in</span> <span class="id" type="var">a</span> (<span class="id" type="var">snoc</span> <span class="id" type="var">l</span> <span class="id" type="var">a</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "l = []". <span class="id" type="tactic">apply</span> <span class="id" type="var">ai_here</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "l = cons". <span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">ai_later</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">appears_in_snoc2</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">appears_in</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;<span class="id" type="var">appears_in</span> <span class="id" type="var">a</span> (<span class="id" type="var">snoc</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "l = []". <span class="id" type="tactic">apply</span> <span class="id" type="var">ai_here</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "l = cons". <span class="id" type="tactic">apply</span> <span class="id" type="var">ai_later</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">IHl</span>. <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">appears_in_snoc3</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">a</span> <span class="id" type="var">b</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">appears_in</span> <span class="id" type="var">a</span> (<span class="id" type="var">snoc</span> <span class="id" type="var">l</span> <span class="id" type="var">b</span>) <span style="font-family: arial;">&rarr;</span><br/>
&nbsp;&nbsp;&nbsp;(<span class="id" type="var">appears_in</span> <span class="id" type="var">a</span> <span class="id" type="var">l</span> <span style="font-family: arial;">&or;</span> <span class="id" type="var">a</span> = <span class="id" type="var">b</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "l = []". <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ai_here". <span class="id" type="var">right</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ai_later". <span class="id" type="var">left</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "l = cons". <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ai_here". <span class="id" type="var">left</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">ai_here</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "ai_later". <span class="id" type="tactic">destruct</span> (<span class="id" type="var">IHl</span> <span class="id" type="var">H1</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">left</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">ai_later</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">right</span>. <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">append_singleton_equation</span> : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">x</span> : <span class="id" type="var">nat</span>) <span class="id" type="var">l</span> <span class="id" type="var">l'</span>,<br/>
&nbsp;&nbsp;(<span class="id" type="var">l</span> ++ [<span class="id" type="var">x</span>]) ++ <span class="id" type="var">l'</span> = <span class="id" type="var">l</span> ++ <span class="id" type="var">x</span> :: <span class="id" type="var">l'</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">x</span> <span class="id" type="var">l</span> <span class="id" type="var">l'</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">append_nil</span> : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" type="var">l</span> ++ [] = <span class="id" type="var">l</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">induction</span> <span class="id" type="var">l</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">IHl</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">list_member_correct</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">l</span> <span class="id" type="var">n</span>,<br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>) = <span class="id" type="var">l</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 0 <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;<span class="id" type="var">list_member</span><br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span> <span style="letter-spacing:-.4em;">}</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">l</span> <span class="id" type="var">n</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_consequence</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">hoare_while</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">P</span> := <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>, <span class="id" type="var">p</span> ++ <span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>) = <span class="id" type="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">p</span>)).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;loop&nbsp;body&nbsp;preserves&nbsp;the&nbsp;invariant:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">hoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">hoare_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "If taken".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">hoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">st</span> [[[<span class="id" type="var">H1</span> [<span class="id" type="var">p</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]] <span class="id" type="var">H9</span>] <span class="id" type="var">H10</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">assn_sub</span>. <span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;(st&nbsp;Y)&nbsp;is&nbsp;still&nbsp;n&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_neq</span>; <span class="id" type="tactic">try</span> (<span class="id" type="tactic">intro</span> <span class="id" type="var">X</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">X</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_neq</span>; <span class="id" type="tactic">try</span> (<span class="id" type="tactic">intro</span> <span class="id" type="var">X</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">X</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;and&nbsp;the&nbsp;interesting&nbsp;part&nbsp;of&nbsp;the&nbsp;invariant&nbsp;is&nbsp;preserved:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;X&nbsp;has&nbsp;to&nbsp;be&nbsp;a&nbsp;cons&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) <span class="id" type="keyword">as</span> [|<span class="id" type="var">h</span> <span class="id" type="var">x'</span>] <span class="id" type="var">eqn</span>:<span class="id" type="var">Heqx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">bassn</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H9</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">beval</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H9</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">aeval</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">Heqx</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H9</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H9</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>(<span class="id" type="var">snoc</span> <span class="id" type="var">p</span> <span class="id" type="var">h</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">aeval</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_neq</span>; <span class="id" type="tactic">try</span> (<span class="id" type="tactic">intro</span> <span class="id" type="var">X</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">X</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">Heqx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">snoc_equation</span>. <span class="id" type="tactic">assumption</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_neq</span>; <span class="id" type="tactic">try</span> (<span class="id" type="tactic">intro</span> <span class="id" type="var">X</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">X</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">bassn</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H10</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">beval</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">aeval</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H10</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">Heqx</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H10</span>. <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> (<span class="id" type="var">beq_nat_true</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H10</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">appears_in_snoc1</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Case</span> "If not taken".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_consequence_pre</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">hoare_skip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">assn_sub</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">st</span> [[[<span class="id" type="var">H1</span> [<span class="id" type="var">p</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]] <span class="id" type="var">H9</span>] <span class="id" type="var">H10</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;(st&nbsp;Y)&nbsp;is&nbsp;still&nbsp;n&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_neq</span>; <span class="id" type="tactic">try</span> (<span class="id" type="tactic">intro</span> <span class="id" type="var">X</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">X</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;and&nbsp;the&nbsp;interesting&nbsp;part&nbsp;of&nbsp;the&nbsp;invariant&nbsp;is&nbsp;preserved:&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;X&nbsp;has&nbsp;to&nbsp;be&nbsp;a&nbsp;cons&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) <span class="id" type="keyword">as</span> [|<span class="id" type="var">h</span> <span class="id" type="var">x'</span>] <span class="id" type="var">eqn</span>:<span class="id" type="var">Heqx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">bassn</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H9</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">beval</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H9</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">aeval</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H9</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">Heqx</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H9</span>. <span class="id" type="tactic">inversion</span> <span class="id" type="var">H9</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>(<span class="id" type="var">snoc</span> <span class="id" type="var">p</span> <span class="id" type="var">h</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_eq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">aeval</span>. <span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">Heqx</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">snoc_equation</span>. <span class="id" type="tactic">assumption</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_neq</span>; <span class="id" type="tactic">try</span> (<span class="id" type="tactic">intro</span> <span class="id" type="var">X</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">X</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">appears_in_snoc2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H3</span>. <span class="id" type="tactic">assumption</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">destruct</span> (<span class="id" type="var">appears_in_snoc3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">H</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "later".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H3</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">_</span> <span class="id" type="var">H3'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">H3'</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "here (absurd)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">bassn</span>, <span class="id" type="var">beval</span>, <span class="id" type="var">aeval</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">not_true_iff_false</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">beq_nat_false</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">Heqx</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H10</span>. <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H10</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ex_falso_quodlibet</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H10</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;The&nbsp;invariant&nbsp;holds&nbsp;at&nbsp;the&nbsp;start&nbsp;of&nbsp;the&nbsp;loop:&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">st</span> [<span class="id" type="var">H1</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]].<br/>
&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H2</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H3</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>[]. <span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;At&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;loop&nbsp;the&nbsp;invariant&nbsp;implies&nbsp;the&nbsp;right&nbsp;thing.&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">intros</span> <span class="id" type="var">st</span> [[<span class="id" type="var">H1</span> [<span class="id" type="var">p</span> [<span class="id" type="var">H2</span> <span class="id" type="var">H3</span>]]] <span class="id" type="var">H5</span>].<br/>
&nbsp;&nbsp;<span class="comment">(*&nbsp;x&nbsp;must&nbsp;be&nbsp;<span class="inlinecode"></span>&nbsp;*)</span><br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">bassn</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H5</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">beval</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H5</span>. <span class="id" type="tactic">unfold</span> <span class="id" type="var">aeval</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H5</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) <span class="id" type="keyword">as</span> [|<span class="id" type="var">h</span> <span class="id" type="var">x'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">append_nil</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span style="font-family: arial;">&larr;</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br/>

<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ex_falso_quodlibet</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H5</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>

<div class="doc">
<a name="lab471"></a><h4 class="section">Exercise: 3 stars (list_sum)</h4>
 Here is a direct definition of the sum of the elements of a list,
    and an Imp program that computes the sum. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">sum</span> <span class="id" type="var">l</span> := <span class="id" type="var">fold_right</span> <span class="id" type="var">plus</span> 0 <span class="id" type="var">l</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">sum_program</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="var">Y</span> ::= <span class="id" type="var">ANum</span> 0;<br/>
&nbsp;&nbsp;<span class="id" type="var">WHILE</span> (<span class="id" type="var">BIsCons</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>)) <span class="id" type="var">DO</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Y</span> ::= <span class="id" type="var">APlus</span> (<span class="id" type="var">AId</span> <span class="id" type="var">Y</span>) (<span class="id" type="var">AHead</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>)) ;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">X</span> ::= <span class="id" type="var">ATail</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>)<br/>
&nbsp;&nbsp;<span class="id" type="var">END</span>.<br/>

<br/>
</div>

<div class="doc">
Provide an <i>informal</i> proof of the following specification of
    <span class="inlinecode"><span class="id" type="var">sum_program</span></span> in the form of a decorated version of the
    program. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">sum_program_spec</span> := <span style="font-family: arial;">&forall;</span><span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>) = <span class="id" type="var">l</span> <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;<span class="id" type="var">sum_program</span><br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">sum</span> <span class="id" type="var">l</span> <span style="letter-spacing:-.4em;">}</span>}.<br/>

<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

<a name="lab472"></a><h4 class="section">Exercise: 4 stars (list_reverse)</h4>
 Recall the function <span class="inlinecode"><span class="id" type="var">rev</span></span> from Poly.v, for reversing lists. 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">rev</span> {<span class="id" type="var">X</span>:<span class="id" type="keyword">Type</span>} (<span class="id" type="var">l</span>:<span class="id" type="var">list</span> <span class="id" type="var">X</span>) : <span class="id" type="var">list</span> <span class="id" type="var">X</span> := <br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">l</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">nil</span>      =&gt; []<br/>
&nbsp;&nbsp;| <span class="id" type="var">cons</span> <span class="id" type="var">h</span> <span class="id" type="var">t</span> =&gt; <span class="id" type="var">snoc</span> (<span class="id" type="var">rev</span> <span class="id" type="var">t</span>) <span class="id" type="var">h</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
</div>

<div class="doc">
Write an Imp program <span class="inlinecode"><span class="id" type="var">list_reverse_program</span></span> that reverses
    lists. Formally prove that it satisfies the following
    specification:

<div class="paragraph"> </div>

<div class="code code-tight">
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&forall;</span><span class="id" type="var">l</span>&nbsp;:&nbsp;<span class="id" type="var">list</span>&nbsp;<span class="id" type="var">nat</span>,<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">X</span>&nbsp;=&nbsp;&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="font-family: arial;">&and;</span>&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">nil</span>&nbsp;<span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">list_reverse_program</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{&nbsp;<span class="id" type="var">Y</span>&nbsp;=&nbsp;<span class="id" type="var">rev</span>&nbsp;<span class="id" type="var">l</span>&nbsp;<span style="letter-spacing:-.4em;">}</span>}.
<div class="paragraph"> </div>

</div>
    You may find the lemmas <span class="inlinecode"><span class="id" type="var">append_nil</span></span> and <span class="inlinecode"><span class="id" type="var">rev_equation</span></span> useful.

</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Lemma</span> <span class="id" type="var">rev_equation</span> : <span style="font-family: arial;">&forall;</span>(<span class="id" type="var">A</span> : <span class="id" type="keyword">Type</span>) (<span class="id" type="var">h</span> : <span class="id" type="var">A</span>) (<span class="id" type="var">x</span> <span class="id" type="var">y</span> : <span class="id" type="var">list</span> <span class="id" type="var">A</span>),<br/>
&nbsp;&nbsp;<span class="id" type="var">rev</span> (<span class="id" type="var">h</span> :: <span class="id" type="var">x</span>) ++ <span class="id" type="var">y</span> = <span class="id" type="var">rev</span> <span class="id" type="var">x</span> ++ <span class="id" type="var">h</span> :: <span class="id" type="var">y</span>.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">snoc_equation</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="comment">(*&nbsp;FILL&nbsp;IN&nbsp;HERE&nbsp;*)</span><br/>
</div>

<div class="doc">
<font size=-2>&#9744;</font> 
<div class="paragraph"> </div>

 Finally, for a bigger example, let's redo the proof of
    <span class="inlinecode"><span class="id" type="var">list_member_correct</span></span> from above using our new tools.

<div class="paragraph"> </div>

    Notice that the <span class="inlinecode"><span class="id" type="var">verify</span></span> tactic leaves subgoals for each
    "interesting" use of <span class="inlinecode"><span class="id" type="var">hoare_consequence</span></span> &mdash; that is, for each <span class="inlinecode">=&gt;</span>
    that occurs in the decorated program, except for the ones that can
    be eliminated by repeated application of a few simple automated
    tactics. Each of these implications relies on a fact about lists,
    for example that <span class="inlinecode"><span class="id" type="var">l</span></span> <span class="inlinecode">++</span> <span class="inlinecode">[]</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">l</span></span>. In other words, the Hoare logic
    infrastructure has taken care of the boilerplate reasoning about
    the execution of imperative programs, while the user has to prove
    lemmas that are specific to the problem domain (e.g. lists or
    numbers). 
</div>
<div class="code code-tight">

<br/>
</div>

<div class="doc">
<a name="lab473"></a><h1 class="section">Formal Decorated Programs</h1>

<div class="paragraph"> </div>

 Again, the definitions are copied verbatim from Hoare.v 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Inductive</span> <span class="id" type="var">dcom</span> : <span class="id" type="keyword">Type</span> :=<br/>
&nbsp;&nbsp;| <span class="id" type="var">DCSkip</span> :  <span class="id" type="var">Assertion</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCSeq</span> : <span class="id" type="var">dcom</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCAsgn</span> : <span class="id" type="var">id</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">aexp</span> <span style="font-family: arial;">&rarr;</span>  <span class="id" type="var">Assertion</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCIf</span> : <span class="id" type="var">bexp</span> <span style="font-family: arial;">&rarr;</span>  <span class="id" type="var">Assertion</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span> <span style="font-family: arial;">&rarr;</span>  <span class="id" type="var">Assertion</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&rarr;</span> <span class="id" type="var">Assertion</span><span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCWhile</span> : <span class="id" type="var">bexp</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">Assertion</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">Assertion</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCPre</span> : <span class="id" type="var">Assertion</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCPost</span> : <span class="id" type="var">dcom</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">Assertion</span> <span style="font-family: arial;">&rarr;</span> <span class="id" type="var">dcom</span>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "dcom_cases" <span class="id" type="var">tactic</span>(<span class="id" type="var">first</span>) <span class="id" type="var">ident</span>(<span class="id" type="var">c</span>) :=<br/>
&nbsp;&nbsp;<span class="id" type="var">first</span>;<br/>
&nbsp;&nbsp;[ <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "Skip" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "Seq" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "Asgn"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "If" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "While"<br/>
&nbsp;&nbsp;| <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "Pre" | <span class="id" type="var">Case_aux</span> <span class="id" type="var">c</span> "Post" ].<br/>

<br/>
<span class="id" type="keyword">Notation</span> "'SKIP' <span style="letter-spacing:-.4em;">{</span>{ P <span style="letter-spacing:-.4em;">}</span>}" <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" type="var">DCSkip</span> <span class="id" type="var">P</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 10) : <span class="id" type="var">dcom_scope</span>.<br/>
<span class="id" type="keyword">Notation</span> "l '::=' a <span style="letter-spacing:-.4em;">{</span>{ P <span style="letter-spacing:-.4em;">}</span>}" <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" type="var">DCAsgn</span> <span class="id" type="var">l</span> <span class="id" type="var">a</span> <span class="id" type="var">P</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 60, <span class="id" type="var">a</span> <span class="id" type="tactic">at</span> <span class="id" type="var">next</span> <span class="id" type="var">level</span>) : <span class="id" type="var">dcom_scope</span>.<br/>
<span class="id" type="keyword">Notation</span> "'WHILE' b 'DO' <span style="letter-spacing:-.4em;">{</span>{ Pbody <span style="letter-spacing:-.4em;">}</span>} d 'END' <span style="letter-spacing:-.4em;">{</span>{ Ppost <span style="letter-spacing:-.4em;">}</span>}" <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" type="var">DCWhile</span> <span class="id" type="var">b</span> <span class="id" type="var">Pbody</span> <span class="id" type="var">d</span> <span class="id" type="var">Ppost</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>) : <span class="id" type="var">dcom_scope</span>.<br/>
<span class="id" type="keyword">Notation</span> "'IFB' b 'THEN' <span style="letter-spacing:-.4em;">{</span>{ P <span style="letter-spacing:-.4em;">}</span>} d 'ELSE' <span style="letter-spacing:-.4em;">{</span>{ P' <span style="letter-spacing:-.4em;">}</span>} d' 'FI' <span style="letter-spacing:-.4em;">{</span>{ Q <span style="letter-spacing:-.4em;">}</span>}" <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" type="var">DCIf</span> <span class="id" type="var">b</span> <span class="id" type="var">P</span> <span class="id" type="var">d</span> <span class="id" type="var">P'</span> <span class="id" type="var">d'</span> <span class="id" type="var">Q</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>)  : <span class="id" type="var">dcom_scope</span>.<br/>
<span class="id" type="keyword">Notation</span> "'=&gt;' <span style="letter-spacing:-.4em;">{</span>{ P <span style="letter-spacing:-.4em;">}</span>} d" <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" type="var">DCPre</span> <span class="id" type="var">P</span> <span class="id" type="var">d</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 90, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>)  : <span class="id" type="var">dcom_scope</span>.<br/>
<span class="id" type="keyword">Notation</span> "<span style="letter-spacing:-.4em;">{</span>{ P <span style="letter-spacing:-.4em;">}</span>} d" <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" type="var">DCPre</span> <span class="id" type="var">P</span> <span class="id" type="var">d</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 90)  : <span class="id" type="var">dcom_scope</span>.<br/>
<span class="id" type="keyword">Notation</span> "d '=&gt;' <span style="letter-spacing:-.4em;">{</span>{ P <span style="letter-spacing:-.4em;">}</span>}" <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" type="var">DCPost</span> <span class="id" type="var">d</span> <span class="id" type="var">P</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 91, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>)  : <span class="id" type="var">dcom_scope</span>.<br/>
<span class="id" type="keyword">Notation</span> " d ; d' " <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;:= (<span class="id" type="var">DCSeq</span> <span class="id" type="var">d</span> <span class="id" type="var">d'</span>) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="tactic">at</span> <span class="id" type="var">level</span> 80, <span class="id" type="var">right</span> <span class="id" type="var">associativity</span>)  : <span class="id" type="var">dcom_scope</span>.<br/>

<br/>
<span class="id" type="keyword">Delimit</span> <span class="id" type="keyword">Scope</span> <span class="id" type="var">dcom_scope</span> <span class="id" type="keyword">with</span> <span class="id" type="var">dcom</span>.<br/>

<br/>
<span class="id" type="keyword">Example</span> <span class="id" type="var">dec_while</span> : <span class="id" type="var">dcom</span> := (<br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">True</span> <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;<span class="id" type="var">WHILE</span> (<span class="id" type="var">BNot</span> (<span class="id" type="var">BEq</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>) (<span class="id" type="var">ANum</span> 0))) <br/>
&nbsp;&nbsp;<span class="id" type="var">DO</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">True</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">bassn</span> (<span class="id" type="var">BNot</span> (<span class="id" type="var">BEq</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>) (<span class="id" type="var">ANum</span> 0))) <span class="id" type="var">st</span><span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">X</span> ::= (<span class="id" type="var">AMinus</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>) (<span class="id" type="var">ANum</span> 1)) <br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">True</span> <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;<span class="id" type="var">END</span><br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">True</span> <span style="font-family: arial;">&and;</span> ~<span class="id" type="var">bassn</span> (<span class="id" type="var">BNot</span> (<span class="id" type="var">BEq</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>) (<span class="id" type="var">ANum</span> 0))) <span class="id" type="var">st</span><span style="letter-spacing:-.4em;">}</span>} =&gt;<br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>) = 0 <span style="letter-spacing:-.4em;">}</span>}<br/>
) % <span class="id" type="var">dcom</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">extract</span> (<span class="id" type="var">d</span>:<span class="id" type="var">dcom</span>) : <span class="id" type="var">com</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">d</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCSkip</span> <span class="id" type="var">_</span>           =&gt; <span class="id" type="var">SKIP</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCSeq</span> <span class="id" type="var">d1</span> <span class="id" type="var">d2</span>        =&gt; (<span class="id" type="var">extract</span> <span class="id" type="var">d1</span> ; <span class="id" type="var">extract</span> <span class="id" type="var">d2</span>) <br/>
&nbsp;&nbsp;| <span class="id" type="var">DCAsgn</span> <span class="id" type="var">X</span> <span class="id" type="var">a</span> <span class="id" type="var">_</span>       =&gt; <span class="id" type="var">X</span> ::= <span class="id" type="var">a</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCIf</span> <span class="id" type="var">b</span> <span class="id" type="var">_</span> <span class="id" type="var">d1</span> <span class="id" type="var">_</span> <span class="id" type="var">d2</span> <span class="id" type="var">_</span> =&gt; <span class="id" type="var">IFB</span> <span class="id" type="var">b</span> <span class="id" type="var">THEN</span> <span class="id" type="var">extract</span> <span class="id" type="var">d1</span> <span class="id" type="var">ELSE</span> <span class="id" type="var">extract</span> <span class="id" type="var">d2</span> <span class="id" type="var">FI</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCWhile</span> <span class="id" type="var">b</span> <span class="id" type="var">_</span> <span class="id" type="var">d</span> <span class="id" type="var">_</span>    =&gt; <span class="id" type="var">WHILE</span> <span class="id" type="var">b</span> <span class="id" type="var">DO</span> <span class="id" type="var">extract</span> <span class="id" type="var">d</span> <span class="id" type="var">END</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCPre</span> <span class="id" type="var">_</span> <span class="id" type="var">d</span>          =&gt; <span class="id" type="var">extract</span> <span class="id" type="var">d</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCPost</span> <span class="id" type="var">d</span> <span class="id" type="var">_</span>         =&gt; <span class="id" type="var">extract</span> <span class="id" type="var">d</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">post</span> (<span class="id" type="var">d</span>:<span class="id" type="var">dcom</span>) : <span class="id" type="var">Assertion</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">d</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCSkip</span> <span class="id" type="var">P</span>                =&gt; <span class="id" type="var">P</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCSeq</span> <span class="id" type="var">d1</span> <span class="id" type="var">d2</span>             =&gt; <span class="id" type="var">post</span> <span class="id" type="var">d2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCAsgn</span> <span class="id" type="var">X</span> <span class="id" type="var">a</span> <span class="id" type="var">Q</span>            =&gt; <span class="id" type="var">Q</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCIf</span>  <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">d1</span> <span class="id" type="var">_</span> <span class="id" type="var">d2</span> <span class="id" type="var">Q</span>     =&gt; <span class="id" type="var">Q</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCWhile</span> <span class="id" type="var">b</span> <span class="id" type="var">Pbody</span> <span class="id" type="var">c</span> <span class="id" type="var">Ppost</span> =&gt; <span class="id" type="var">Ppost</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCPre</span> <span class="id" type="var">_</span> <span class="id" type="var">d</span>               =&gt; <span class="id" type="var">post</span> <span class="id" type="var">d</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCPost</span> <span class="id" type="var">c</span> <span class="id" type="var">Q</span>              =&gt; <span class="id" type="var">Q</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">pre</span> (<span class="id" type="var">d</span>:<span class="id" type="var">dcom</span>) : <span class="id" type="var">Assertion</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">d</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCSkip</span> <span class="id" type="var">P</span>                =&gt; <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCSeq</span> <span class="id" type="var">c1</span> <span class="id" type="var">c2</span>             =&gt; <span class="id" type="var">pre</span> <span class="id" type="var">c1</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCAsgn</span> <span class="id" type="var">X</span> <span class="id" type="var">a</span> <span class="id" type="var">Q</span>            =&gt; <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCIf</span>  <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">t</span> <span class="id" type="var">_</span> <span class="id" type="var">e</span> <span class="id" type="var">_</span>       =&gt; <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCWhile</span> <span class="id" type="var">b</span> <span class="id" type="var">Pbody</span> <span class="id" type="var">c</span> <span class="id" type="var">Ppost</span> =&gt; <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">True</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCPre</span> <span class="id" type="var">P</span> <span class="id" type="var">c</span>               =&gt; <span class="id" type="var">P</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCPost</span> <span class="id" type="var">c</span> <span class="id" type="var">Q</span>              =&gt; <span class="id" type="var">pre</span> <span class="id" type="var">c</span><br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">dec_correct</span> (<span class="id" type="var">d</span>:<span class="id" type="var">dcom</span>) := <br/>
&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">pre</span> <span class="id" type="var">d</span><span style="letter-spacing:-.4em;">}</span>} (<span class="id" type="var">extract</span> <span class="id" type="var">d</span>) <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">post</span> <span class="id" type="var">d</span><span style="letter-spacing:-.4em;">}</span>}.<br/>

<br/>
<span class="id" type="keyword">Fixpoint</span> <span class="id" type="var">verification_conditions</span> (<span class="id" type="var">P</span> : <span class="id" type="var">Assertion</span>) (<span class="id" type="var">d</span>:<span class="id" type="var">dcom</span>) : <span class="id" type="keyword">Prop</span> :=<br/>
&nbsp;&nbsp;<span class="id" type="keyword">match</span> <span class="id" type="var">d</span> <span class="id" type="keyword">with</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCSkip</span> <span class="id" type="var">Q</span>          =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">Q</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">DCSeq</span> <span class="id" type="var">d1</span> <span class="id" type="var">d2</span>      =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">verification_conditions</span> <span class="id" type="var">P</span> <span class="id" type="var">d1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span class="id" type="var">verification_conditions</span> (<span class="id" type="var">post</span> <span class="id" type="var">d1</span>) <span class="id" type="var">d2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCAsgn</span> <span class="id" type="var">X</span> <span class="id" type="var">a</span> <span class="id" type="var">Q</span>      =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">assn_sub</span> <span class="id" type="var">X</span> <span class="id" type="var">a</span> <span class="id" type="var">Q</span>)<br/>
&nbsp;&nbsp;| <span class="id" type="var">DCIf</span> <span class="id" type="var">b</span> <span class="id" type="var">P1</span> <span class="id" type="var">d1</span> <span class="id" type="var">P2</span> <span class="id" type="var">d2</span> <span class="id" type="var">Q</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">st</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">bassn</span> <span class="id" type="var">b</span> <span class="id" type="var">st</span>) <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">P1</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> ((<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">P</span> <span class="id" type="var">st</span> <span style="font-family: arial;">&and;</span> ~ (<span class="id" type="var">bassn</span> <span class="id" type="var">b</span> <span class="id" type="var">st</span>)) <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">P2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">Q</span> = <span class="id" type="var">post</span> <span class="id" type="var">d1</span>) <span style="font-family: arial;">&and;</span> (<span class="id" type="var">Q</span> = <span class="id" type="var">post</span> <span class="id" type="var">d2</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span class="id" type="var">verification_conditions</span> <span class="id" type="var">P1</span> <span class="id" type="var">d1</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span class="id" type="var">verification_conditions</span> <span class="id" type="var">P2</span> <span class="id" type="var">d2</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCWhile</span> <span class="id" type="var">b</span> <span class="id" type="var">Pbody</span> <span class="id" type="var">d</span> <span class="id" type="var">Ppost</span>      =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;post&nbsp;d&nbsp;is&nbsp;the&nbsp;loop&nbsp;invariant&nbsp;and&nbsp;the&nbsp;initial&nbsp;precondition&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">post</span> <span class="id" type="var">d</span>)  <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">Pbody</span> = (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">post</span> <span class="id" type="var">d</span> <span class="id" type="var">st</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">bassn</span> <span class="id" type="var">b</span> <span class="id" type="var">st</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">Ppost</span> = (<span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">post</span> <span class="id" type="var">d</span> <span class="id" type="var">st</span> <span style="font-family: arial;">&and;</span> ~(<span class="id" type="var">bassn</span> <span class="id" type="var">b</span> <span class="id" type="var">st</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span class="id" type="var">verification_conditions</span> <span class="id" type="var">Pbody</span> <span class="id" type="var">d</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCPre</span> <span class="id" type="var">P'</span> <span class="id" type="var">d</span>         =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">P</span> <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">P'</span>) <span style="font-family: arial;">&and;</span> <span class="id" type="var">verification_conditions</span> <span class="id" type="var">P'</span> <span class="id" type="var">d</span><br/>
&nbsp;&nbsp;| <span class="id" type="var">DCPost</span> <span class="id" type="var">d</span> <span class="id" type="var">Q</span>        =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">verification_conditions</span> <span class="id" type="var">P</span> <span class="id" type="var">d</span> <span style="font-family: arial;">&and;</span> (<span class="id" type="var">post</span> <span class="id" type="var">d</span> <span style="font-family: arial;">&#8702;</span> <span class="id" type="var">Q</span>)<br/>
&nbsp;&nbsp;<span class="id" type="keyword">end</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">verification_correct</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">d</span> <span class="id" type="var">P</span>, <br/>
&nbsp;&nbsp;<span class="id" type="var">verification_conditions</span> <span class="id" type="var">P</span> <span class="id" type="var">d</span> <span style="font-family: arial;">&rarr;</span> <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">P</span><span style="letter-spacing:-.4em;">}</span>} (<span class="id" type="var">extract</span> <span class="id" type="var">d</span>) <span style="letter-spacing:-.4em;">{</span>{<span class="id" type="var">post</span> <span class="id" type="var">d</span><span style="letter-spacing:-.4em;">}</span>}.<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">dcom_cases</span> (<span class="id" type="tactic">induction</span> <span class="id" type="var">d</span>) <span class="id" type="var">Case</span>; <span class="id" type="tactic">intros</span> <span class="id" type="var">P</span> <span class="id" type="var">H</span>; <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> *.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "Skip".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">hoare_skip</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "Seq".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">H1</span> <span class="id" type="var">H2</span>]. <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_seq</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHd2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHd1</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "Asgn".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">hoare_asgn</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "If".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">HPre1</span> [<span class="id" type="var">HPre2</span> [<span class="id" type="var">Hd1</span> [<span class="id" type="var">Hd2</span> [<span class="id" type="var">HThen</span> <span class="id" type="var">HElse</span>]]]]]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">hoare_if</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_consequence_pre</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">IHd1</span>. <span class="id" type="var">eassumption</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">Hd2</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_consequence_pre</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">IHd2</span>. <span class="id" type="var">eassumption</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "While".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Hpre</span> [<span class="id" type="var">Hbody</span> [<span class="id" type="var">Hpost</span> <span class="id" type="var">Hd</span>]]]; <span class="id" type="tactic">subst</span>; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_consequence_pre</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">hoare_while</span> <span class="id" type="keyword">with</span> (<span class="id" type="var">P</span> := <span class="id" type="var">post</span> <span class="id" type="var">d</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">IHd</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">Hd</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "Pre".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">HP</span> <span class="id" type="var">Hd</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_consequence_pre</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">IHd</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">Hd</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "Post".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">Hd</span> <span class="id" type="var">HQ</span>]; <span class="id" type="tactic">clear</span> <span class="id" type="var">H</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">eapply</span> <span class="id" type="var">hoare_consequence_post</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">IHd</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">Hd</span>. <span class="id" type="tactic">assumption</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
<span class="id" type="keyword">Tactic Notation</span> "verify" :=<br/>
&nbsp;&nbsp;<span class="id" type="tactic">try</span> <span class="id" type="tactic">apply</span> <span class="id" type="var">verification_correct</span>; <br/>
&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">split</span>;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>; <span class="id" type="tactic">unfold</span> <span class="id" type="var">assert_implies</span>; <br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">bassn</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">unfold</span> <span class="id" type="var">beval</span> <span class="id" type="keyword">in</span> *; <span class="id" type="tactic">unfold</span> <span class="id" type="var">aeval</span> <span class="id" type="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">unfold</span> <span class="id" type="var">assn_sub</span>; <span class="id" type="tactic">intros</span>;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_eq</span>;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> (<span class="id" type="tactic">rewrite</span> <span class="id" type="var">update_neq</span>; [| (<span class="id" type="tactic">intro</span> <span class="id" type="var">X</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">X</span>)]);<br/>
&nbsp;&nbsp;<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> *; <br/>
&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> <span class="id" type="keyword">match</span> <span class="id" type="var">goal</span> <span class="id" type="keyword">with</span> [<span class="id" type="var">H</span> : <span class="id" type="var">_</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">_</span> <span style="font-family: arial;">&#8866;</span> <span class="id" type="var">_</span>] =&gt; <span class="id" type="tactic">destruct</span> <span class="id" type="var">H</span> <span class="id" type="keyword">end</span>;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">rewrite</span> <span class="id" type="var">not_true_iff_false</span> <span class="id" type="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">rewrite</span> <span class="id" type="var">not_false_iff_true</span> <span class="id" type="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">rewrite</span> <span class="id" type="var">negb_true_iff</span> <span class="id" type="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">rewrite</span> <span class="id" type="var">negb_false_iff</span> <span class="id" type="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">rewrite</span> <span class="id" type="var">beq_nat_true_iff</span> <span class="id" type="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">repeat</span> <span class="id" type="tactic">rewrite</span> <span class="id" type="var">beq_nat_false_iff</span> <span class="id" type="keyword">in</span> *;<br/>
&nbsp;&nbsp;<span class="id" type="tactic">try</span> <span class="id" type="tactic">eauto</span>; <span class="id" type="tactic">try</span> <span class="id" type="tactic">omega</span>.<br/>

<br/>
</div>

<div class="doc">
Finally, for a bigger example, let's redo the proof of
    <span class="inlinecode"><span class="id" type="var">list_member_correct</span></span> from above using our new tools.

<div class="paragraph"> </div>

    Notice that the <span class="inlinecode"><span class="id" type="var">verify</span></span> tactic leaves subgoals for each
    "interesting" use of <span class="inlinecode"><span class="id" type="var">hoare_consequence</span></span> &mdash; that is, for each <span class="inlinecode">=&gt;</span>
    that occurs in the decorated program, except for the ones that can
    be eliminated by repeated application of a few simple automated
    tactics. Each of these implications relies on a fact about lists,
    for example that <span class="inlinecode"><span class="id" type="var">l</span></span> <span class="inlinecode">++</span> <span class="inlinecode">[]</span> <span class="inlinecode">=</span> <span class="inlinecode"><span class="id" type="var">l</span></span>. In other words, the Hoare logic
    infrastructure has taken care of the boilerplate reasoning about
    the execution of imperative programs, while the user has to prove
    lemmas that are specific to the problem domain (e.g. lists or
    numbers). 
</div>
<div class="code code-tight">

<br/>
<span class="id" type="keyword">Definition</span> <span class="id" type="var">list_member_dec</span> (<span class="id" type="var">n</span> : <span class="id" type="var">nat</span>) (<span class="id" type="var">l</span> : <span class="id" type="var">list</span> <span class="id" type="var">nat</span>) : <span class="id" type="var">dcom</span> := (<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>) = <span class="id" type="var">l</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <span style="font-family: arial;">&and;</span> <span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 0 <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;<span class="id" type="var">WHILE</span> <span class="id" type="var">BIsCons</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>)<br/>
&nbsp;&nbsp;<span class="id" type="var">DO</span> <span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; (<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>, <span class="id" type="var">p</span> ++ <span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>) = <span class="id" type="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">p</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span class="id" type="var">bassn</span> (<span class="id" type="var">BIsCons</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>)) <span class="id" type="var">st</span> <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">IFB</span> (<span class="id" type="var">BEq</span> (<span class="id" type="var">AId</span> <span class="id" type="var">Y</span>) (<span class="id" type="var">AHead</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>))) <span class="id" type="var">THEN</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>, <span class="id" type="var">p</span> ++ <span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>) = <span class="id" type="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">p</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span class="id" type="var">bassn</span> (<span class="id" type="var">BIsCons</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>)) <span class="id" type="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span class="id" type="var">bassn</span> (<span class="id" type="var">BEq</span> (<span class="id" type="var">AId</span> <span class="id" type="var">Y</span>) (<span class="id" type="var">AHead</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>))) <span class="id" type="var">st</span> <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>, <span class="id" type="var">p</span> ++ <span class="id" type="var">tail</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) = <span class="id" type="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (1 = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">p</span>)) <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">Z</span> ::= <span class="id" type="var">ANum</span> 1<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>, <span class="id" type="var">p</span> ++ <span class="id" type="var">tail</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) = <span class="id" type="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">p</span>)) <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">ELSE</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;((<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>, <span class="id" type="var">p</span> ++ <span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>) = <span class="id" type="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">p</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> <span class="id" type="var">bassn</span> (<span class="id" type="var">BIsCons</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>)) <span class="id" type="var">st</span>)<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> ~<span class="id" type="var">bassn</span> (<span class="id" type="var">BEq</span> (<span class="id" type="var">AId</span> <span class="id" type="var">Y</span>) (<span class="id" type="var">AHead</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>))) <span class="id" type="var">st</span> <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>, <span class="id" type="var">p</span> ++ <span class="id" type="var">tail</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) = <span class="id" type="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">p</span>)) <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SKIP</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>, <span class="id" type="var">p</span> ++ <span class="id" type="var">tail</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) = <span class="id" type="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">p</span>)) <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">FI</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>, <span class="id" type="var">p</span> ++ <span class="id" type="var">tail</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) = <span class="id" type="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">p</span>)) <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;;<br/>
&nbsp;&nbsp;&nbsp;<span class="id" type="var">X</span> ::= (<span class="id" type="var">ATail</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span>  =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <span style="font-family: arial;">&and;</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span> : <span class="id" type="var">list</span> <span class="id" type="var">nat</span>, <span class="id" type="var">p</span> ++ <span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>) = <span class="id" type="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">p</span>)) <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;<span class="id" type="var">END</span><br/>
&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt;<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Y</span>) = <span class="id" type="var">n</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span style="font-family: arial;">&exist;</span><span class="id" type="var">p</span>, <span class="id" type="var">p</span> ++ <span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>) = <span class="id" type="var">l</span> <br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> (<span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">p</span>)))<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&and;</span> ~<span class="id" type="var">bassn</span> (<span class="id" type="var">BIsCons</span> (<span class="id" type="var">AId</span> <span class="id" type="var">X</span>)) <span class="id" type="var">st</span> <span style="letter-spacing:-.4em;">}</span>}<br/>
&nbsp;&nbsp;&nbsp;=&gt;<br/>
&nbsp;&nbsp;&nbsp;<span style="letter-spacing:-.4em;">{</span>{ <span class="id" type="keyword">fun</span> <span class="id" type="var">st</span> =&gt; <span class="id" type="var">asnat</span> (<span class="id" type="var">st</span> <span class="id" type="var">Z</span>) = 1 <span style="font-family: arial;">&harr;</span> <span class="id" type="var">appears_in</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span> <span style="letter-spacing:-.4em;">}</span>}<br/>
) %<span class="id" type="var">dcom</span>.<br/>

<br/>
<span class="id" type="keyword">Theorem</span> <span class="id" type="var">list_member_correct'</span> : <span style="font-family: arial;">&forall;</span><span class="id" type="var">n</span> <span class="id" type="var">l</span>,<br/>
&nbsp;&nbsp;<span class="id" type="var">dec_correct</span> (<span class="id" type="var">list_member_dec</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span>).<br/>
<span class="id" type="keyword">Proof</span>.<br/>
&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">n</span> <span class="id" type="var">l</span>. <span class="id" type="var">verify</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "The loop precondition holds.".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>[]. <span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H1</span>. <span class="id" type="tactic">split</span>; <span class="id" type="tactic">intro</span> <span class="id" type="var">Hc</span>; <span class="id" type="tactic">inversion</span> <span class="id" type="var">Hc</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "IF taken".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;know&nbsp;X&nbsp;is&nbsp;non-nil.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) <span class="id" type="keyword">as</span> [|<span class="id" type="var">h</span> <span class="id" type="var">x'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>(<span class="id" type="var">snoc</span> <span class="id" type="var">p</span> <span class="id" type="var">h</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">simpl</span>. <span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">snoc_equation</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">H</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>. <span class="id" type="tactic">rewrite</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">appears_in_snoc1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">_</span>. <span class="id" type="tactic">reflexivity</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "If not taken".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="comment">(*&nbsp;We&nbsp;know&nbsp;X&nbsp;is&nbsp;non-nil.&nbsp;*)</span><br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) <span class="id" type="keyword">as</span> [|<span class="id" type="var">h</span> <span class="id" type="var">x'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span style="font-family: arial;">&exist;</span>(<span class="id" type="var">snoc</span> <span class="id" type="var">p</span> <span class="id" type="var">h</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>. <span class="id" type="tactic">simpl</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">snoc_equation</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">split</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">appears_in_snoc2</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H4</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">intros</span> <span class="id" type="var">Hai</span>. <span class="id" type="tactic">destruct</span> (<span class="id" type="var">appears_in_snoc3</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">_</span> <span class="id" type="var">Hai</span>).<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "later". <span class="id" type="tactic">apply</span> <span class="id" type="var">H4</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="var">SCase</span> "here (absurd)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">subst</span>. <span class="id" type="tactic">simpl</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H0</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">apply</span> <span class="id" type="var">ex_falso_quodlibet</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H0</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "Loop postcondition implies desired conclusion (-&gt;)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) <span class="id" type="keyword">as</span> [|<span class="id" type="var">h</span> <span class="id" type="var">x'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">append_nil</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H3</span>. <span class="id" type="tactic">subst</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H4</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>.<br/>
&nbsp;&nbsp;<span class="id" type="var">Case</span> "loop postcondition implies desired conclusion (&lt;-)".<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> <span class="id" type="var">H2</span> <span class="id" type="keyword">as</span> [<span class="id" type="var">p</span> [<span class="id" type="var">H3</span> <span class="id" type="var">H4</span>]].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">destruct</span> (<span class="id" type="var">aslist</span> (<span class="id" type="var">st</span> <span class="id" type="var">X</span>)) <span class="id" type="keyword">as</span> [|<span class="id" type="var">h</span> <span class="id" type="var">x'</span>].<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">rewrite</span> <span class="id" type="var">append_nil</span> <span class="id" type="keyword">in</span> <span class="id" type="var">H3</span>. <span class="id" type="tactic">subst</span>. <span class="id" type="tactic">apply</span> <span class="id" type="var">H4</span>. <span class="id" type="tactic">assumption</span>.<br/>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="id" type="tactic">inversion</span> <span class="id" type="var">H1</span>.<br/>
<span class="id" type="keyword">Qed</span>.<br/>

<br/>
</div>
</div>

<div id="footer">
<hr/><a href="coqindex.html">Index</a><hr/>This page has been generated by <a href="http://www.lix.polytechnique.fr/coq/">coqdoc</a>
</div>

</div>

</body>
</html>